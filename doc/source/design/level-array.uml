   @startuml

   box "Inference arrays" #LightBlue
   participant array_i as a0
   participant array_j as a2
   end box

   box "Root process" #LightYellow
   participant "Root process" as root
   end box

   box "Block levels" #LightPink
   participant "B0" as b0
   participant "B1" as b1
   participant "B2" as b2
   participant "B3" as b3
   participant "B4" as b4
   end box

   == 1. evaluate ==

   b2 -> b2 : apply_criteria()
   b3 -> b3
   b4 -> b4

   b4 -> b3 : p_merge_masks()
   b3 -> b2

   b2 -> b1 : p_count_arrays()
   b1 -> b0
   b0 -> root

   hnote over root : sync-root-blocks

   root -> root : set_array_sync()

   == 2. allocate ==

   b2 -> a0 : p_create_level_array()
   activate a0 #DarkSalmon
   b2 -> a2
   activate a2 #DarkSalmon

   a0 -> root : p_level_array_created()
   a2 -> root

   hnote over root : sync-level-arrays
   root -> root : doneInserting()

   == 3. populate ==

   a0 -> b2 : p_req_data()
   b2 -> b3
   b3 -> b4

   a2 -> b2
   b2 -> b3
   b3 -> b4

   b2 ->   a0 : p_send_data()
   b3 ->   a0
   b4 ->   a0

   b2  ->   a2
   b3  ->   a2
   b4  ->   a2

   == 4. apply inference ==

   a0 -> a0 : apply_inference()
   a2 -> a2

  == 5. update blocks ==

   a0 -> b2 : p_update()
   b2 -> b3
   b3 -> b4

   a2 -> b2
   b2 -> b3
   b3 -> b4


   deactivate a0
   deactivate a2

@enduml